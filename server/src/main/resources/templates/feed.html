<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>MyFeed</title>
    <style>
        .container {
            width: 500px;
            border: 1px solid #454d55;
            cursor: pointer;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
<div th:text="|Hello, ${username}. Did you see this?|"></div>
<div style="width: 500px;">
    <h2 style="display: inline-block; margin: 5px auto">BOARD</h2>
    <button type="button"
            onclick="createBoard()"
            style="text-align: right; display: inline-block">글쓰기</button>
</div>
<div class="container" th:each="entry : ${boardAndContents}">
    <div th:onclick="|location.href='@{/board/{id}(id=${entry.key.id})}'|">
        <div th:with="board = ${entry.key}">
            <p>작성자 : <span th:text="${board.userEmail}">email</span></p>
            <p>제목 : <span th:text="${board.title}">title</span></p>
            <p>상태 : <span th:text="${board.status}">status</span></p>
        </div>
        <div th:with="contents = ${entry.value}">
            &lt;내용&gt;
            <div th:each="content : ${contents}">
                <p th:text="${content.content}"> content</p>
            </div>
        </div>
    </div>
</div>
<p th:if="${#maps.size(boardAndContents) < 1}">작성한 게시글이 없습니다.</p>
<hr>
<h2>COMMENT</h2>
<div class="container" th:each="comment : ${comments}">
    <div>
        <p>작성자 : <span th:text="${comment.userEmail}">userName</span></p>
        <p>내용 : <span th:text="${comment.comment}">comment</span></p>
    </div>
</div>
<p th:if="${#lists.size(comments) < 1}">작성한 댓글이 없습니다.</p>
</body>
<script>
    function goToBoard(id) {
        window.location.href = "http://localhost:8080/board/" + id;
    }

    async function createBoard(url = "http://localhost:8080/api/board") {
        await fetch(url, {
            method: "GET",
            headers: {
                'Content-Type': 'application/json'
            },
            mode: "cors",
        })
            .then((response) => response.json())
            .then((data) => {
                alert(data.message);
                if(data.success) {
                    window.location.href = "http://localhost:8080/board/" + data.data;
                }
            })
            .catch((error) => console.log("실패 : ", error));
    }
</script>
</html>